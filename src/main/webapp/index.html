<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" type="text/css"
	href="http://yui.yahooapis.com/3.18.1/build/cssreset-context/cssreset-context-min.css">
<style type="text/css">
body {
	width: 800px;
}

table {
    margin:5px;
	border-collapse: collapse;
}

tr:nth-child(odd) td {
	background-color: white;
}

td, th {
	border: solid;
	background-color: lightblue;
}
td.book_center{
    text-align: center;
}

th {
	background-color: aqua;
}
</style>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"
	integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
	crossorigin="anonymous"></script>
<script>
	function fetch() {
		return $.ajax({
			type : "GET",
			url : "./api/book/",
			dataType : "json",
			timeout : 10000
		})
	}

    function update(){
        fetch().done(function(data){
            render(data);
        });
    }

    function render(booklist){
            $("#target").empty();
            booklist.forEach(function(value,index){
                console.log(value);
                var tr = $("<tr></tr>",{"class":"book_tr"}).appendTo("#target");
                var button1 = $("<button></button>",{"data-id":index,text:"削除"})
                var button2 = $("<button></button>",{"data-id":index,text:"編集"})
                $("<td></td>",{"class":"book_center"}).append(button1,button2).appendTo(tr);
                $("<td></td>",{text:value.name}).appendTo(tr);
                $("<td></td>",{text:value.publisher}).appendTo(tr);
                $("<td></td>",{text:value.isbn}).appendTo(tr);            
            })
    }

    function push(book){
        return $.ajax({
            type : "POST",
			url : "./api/book/",
			dataType : "json",
            contentType: 'application/json',
            data:JSON.stringify(book),
            scriptCharset: 'utf-8',
			timeout : 10000
        }).done(function(data){
            console.log("ok")
        }).fail(err => {
            console.log("miss");
            console.log(err);
        });
    }

    update();

</script>
</head>
<body>
	<h1>Hello JAX-RS</h1>
	<p>
		<a href="./api/book/0">api</a>
	</p>
    <button>a</button>
    <button>a</button>
    <table>
        <thead>
			<tr>
                <th>ボタン</th>
				<th>書名</th>
				<th>出版社</th>
				<th>ISBN</th>
			</tr>
		</thead>
        <tbody>
            <tr>
                <td class="book_center"><button id="push">新規登録</button></td>                
                <td><input type="text"/></td>
                <td><input type="text" /></td>
                <td><input type="text" /></td>
            </tr>
        </tbody>
    </table>

	<table>
		<thead>
			<tr>
                <th>ボタン</th>
				<th>書名</th>
				<th>出版社</th>
				<th>ISBN</th>
			</tr>
		</thead>
		<tbody id="target">
		</tbody>
	</table>
</body>

</html>